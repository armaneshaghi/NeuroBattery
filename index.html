<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>NeuroBattery by jeffduda</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">NeuroBattery</h1>
        <p class="header">Smashing through the boundaries - of current neuroimage analysis limitations</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/jeffduda/NeuroBattery/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/jeffduda/NeuroBattery/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/jeffduda/NeuroBattery">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/jeffduda">jeffduda</a></p>


      </header>
      <section>
        <h1>
<a name="neurobattery" class="anchor" href="#neurobattery"><span class="octicon octicon-link"></span></a>NeuroBattery</h1>

<p>Here we provide a working example that illustrates the use of Advanced Normalization Tools (<a href="https://github.com/stnava/ANTs">ANTs</a>) to process multiple MR image types for a single subject. We provide and example input data for a single subject for which a battery of 5 different images were acquired in a single scanning session: </p>

<ol>
<li>T1 (MPRAGE)</li>
<li>pseudo continuous arterial spin labeling (PCASL)</li>
<li>diffusion weighted/tensor</li>
<li>magnetization transfer</li>
<li>resting state BOLD</li>
</ol><p>Additionally we provide a template and associated labels &amp; priors that we use as an anatomical basis for processing as well as a set of verified output image to ensure that your version is working correctly. The general concept is to use the anatomical information in the T1 images as a spatial frame-of-reference. Accordingly we find a spatial mapping between each subject's T1 image and the T1 template. Later, for additional MR images, we will perform intra subject alignment to the T1 allowing for mapping to template space by composing multiple transforms and retaining the concept of relying on the T1 images for anatomical reference for both intra and inter subject exploration of the data. After aligning the T1 image to the template we generate various images relating to anatomical properties of the brain. </p>

<h2>
<a name="t1-mprage-image-processing" class="anchor" href="#t1-mprage-image-processing"><span class="octicon octicon-link"></span></a>T1 (MPRAGE) image processing</h2>

<p>A template image along with associated tissue-type priors serves as the reference for a registration-based approach to processing of the T1 subject data. Below are some example illustrations of the included template (<code>data/template/T_template.nii.gz</code>).</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/template_t1_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/template_t1_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/template_t1_coronal.png?raw=true" alt="Full C"></p>

<p>A brain mask of the template will help extract the brain from the input (<code>data/template/T_templateProbabilityMask.nii.gz</code>)</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/template_t1_mask_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/template_t1_mask_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/template_t1_mask_coronal.png?raw=true" alt="Full C"></p>

<p>And tissue priors in the template will help segment the input data. Red=CSF, Green=Cortex, Blue=White matter, and Yellow=Deep gray matter (<code>data/template/Priors/priors%d.nii.gz</code>)</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/template_t1_prior_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/template_t1_prior_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/template_t1_prior_coronal.png?raw=true" alt="Full C"></p>

<p>These images, along with subject T1 data are used to generate a number of useful outputs, including:</p>

<ol>
<li>Bias corrected version of input image via N4</li>
<li>Brain extraction mask (cerebrum)</li>
<li>4-tissue segmentation (CSF,white matter, cortex, and deep gray matter)</li>
<li>Cortical thickness</li>
<li>Spatial transform to template space (and inverse transform)</li>
</ol><p>In the script directory, <code>process_t1.sh</code> provides an example call to <code>antsCorticalThickness.sh</code> which is used to achieve the steps listed above. The full command is:</p>

<blockquote>
<p>sh  antsCorticalThickness.sh -d 3 \<br>
   -a ../data/input/PEDS012/20121031/Anatomy/PEDS012_20121031_mprage_t1.nii.gz \<br>
   -e ../data/template/T_template.nii.gz \<br>
   -m ../data/template/T_templateProbabilityMask.nii.gz \<br>
   -p ../data/template/Priors/priors%d.nii.gz \<br>
   -t ../data/template/T_template.nii.gz \<br>
   -k 1 \<br>
   -n 3 \<br>
   -w 0.25 \<br>
   -o ../data/output/PEDS012/20121031/PEDS012_20121031_ </p>
</blockquote>

<p>Here are some sample slices from the provided T1 input data (<code>data/input/PEDS012/20121031/Anatomy/PEDS012_20121031_mprage_t1.nii.gz</code>) followed by the results provided by <code>antsCorticalThickness.sh</code>.</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1_coronal.png?raw=true" alt="Full C"></p>

<p>The extracted cerebrum image:</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1brain_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1brain_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1brain_coronal.png?raw=true" alt="Full C"></p>

<p>The 4-class segmentation:</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1seg_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1seg_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1seg_coronal.png?raw=true" alt="Full C"></p>

<p>The cortical thickness, displayed as a heat-map overlay:</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1thick_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1thick_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1thick_coronal.png?raw=true" alt="Full C"></p>

<p>For quality control, we can visualize the mean cortical thickness within brain regions. The values for this subject are represented by the thick black line, while the red and blue lines represent the values for other subjects (blue=male) from the same dataset. </p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/thickness_spider.png?raw=true" alt="Full C"></p>

<p>Having processed the T1 image, we want to continue to use this data as our anatomical frame-of-reference. The processing of the additional data will all follow a similar pattern:</p>

<ol>
<li>Initial preprocessing to obtain a derived scalar image with relevant anatomical detail</li>
<li>Alignment of the derived scalar to the T1 data</li>
<li>Propagation of relevant labels, such as the brain mask, etc.</li>
<li>Quantification of modality specific metrics of interest.</li>
</ol><p>The output provided by antsCorticalThickness provides a brain extraction that extract cerebrum only. For inter-modality matching, we have found it useful to obtain a full-brain image, i.e. one that includes the cerebellum and brainstem. This image provides a reference for matching other modalities, such as diffusion weighted imaging, where there is signal throughout the brain, but little to no signal in the skull. A full-brain mask is included with the template (<code>data/template/T_templateFullBrainMask.nii.gz</code>). The same process used in <code>antsCorticalThickness.sh</code> is used to extract the brain, the only difference is that the cerebrum mask is replaced with the full brain mask.</p>

<p>Full-brain extraction</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1fullbrain_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1fullbrain_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_t1fullbrain_coronal.png?raw=true" alt="Full C"></p>

<h2>
<a name="diffusion-weighted-image-processing" class="anchor" href="#diffusion-weighted-image-processing"><span class="octicon octicon-link"></span></a>Diffusion weighted image processing</h2>

<p>The following steps are used to process diffusion tensor data. For the registration to T1, the T1 image is resample to 2mm isotropic voxels. Since the DWI is lower resolution than the T1, this provides a sufficient balance between accuracy, processing time, and disk space usage.</p>

<ol>
<li>Motion correction of the diffusion weighted volumes</li>
<li>Calculation of the diffusion tensor</li>
<li>Calculation of the mean diffusion weighted image (mDWI)</li>
<li>Registration and mDWI and the subjects full brain T1</li>
</ol><p>Here are slices from the subjects mDWI in it's original space</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dwi_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dwi_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dwi_coronal.png?raw=true" alt="Full C"></p>

<p>The mDWI aligned to T1 and masked to cerebrum only</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dwit1_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dwit1_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dwit1_coronal.png?raw=true" alt="Full C"></p>

<p>The subjects DT image is warped into T1 space and used to calculate a variety of metrics</p>

<p>Fractional Anisotropy</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_fa_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_fa_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_fa_coronal.png?raw=true" alt="Full C"></p>

<p>Primary direction of diffusion as overlay on T1</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dec_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dec_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dec_coronal.png?raw=true" alt="Full C"></p>

<p>Mean Diffusion</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_md_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_md_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_md_coronal.png?raw=true" alt="Full C"></p>

<p>Radial Diffusion</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_rd_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_rd_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_rd_coronal.png?raw=true" alt="Full C"></p>

<p>The AAL labels may then be transformed from the template into the subject DTI space for use as targets in fiber tractography, here illustrated as an overlay on the mDWI</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dtiaal_axial.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dtiaal_sagittal.png?raw=true" alt="Full C"><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/input_dtiaal_coronal.png?raw=true" alt="Full C"></p>

<p>Whole brain tractography is used to obtain the following set of streamlines</p>

<p><img src="https://github.com/jeffduda/NeuroBattery/blob/master/figures/fibertracts.png?raw=true" alt="Full C"></p>

<h2>
<a name="pseudo-continuous-arterial-spin-labeling-pcasl-image-processing" class="anchor" href="#pseudo-continuous-arterial-spin-labeling-pcasl-image-processing"><span class="octicon octicon-link"></span></a>Pseudo continuous arterial spin labeling (PCASL) image processing</h2>

<h2>
<a name="resting-bold-fmri-processing" class="anchor" href="#resting-bold-fmri-processing"><span class="octicon octicon-link"></span></a>Resting BOLD fMRI processing</h2>

<h2>
<a name="magnetization-transfer-processing" class="anchor" href="#magnetization-transfer-processing"><span class="octicon octicon-link"></span></a>Magnetization transfer processing</h2>

<p><strong>Whipping up a fury, Dominating flurry</strong></p>

<p><strong>We create the Battery</strong></p>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
